from uuid import uuid4
from tempfile import gettempdir
import os

import fasteners

from zalo.zalo_exception.zalo_exception import TwoProcessRunningAtSameTimeException


class ParallelLoker:
    """ use context manager"""

    def __init__(self, file_name=None, location=None):
        if file_name is None:
            file_name = str(uuid4())
        if location is None:
            location = gettempdir()

        self.file_path = os.path.join(location, file_name)

        self._lock = fasteners.process_lock.InterProcessLock(self.file_path)

    def __enter__(self):
        if not self._lock.acquire():
            raise TwoProcessRunningAtSameTimeException(" Don't permit 2 process running at the same time")

    def __exit__(self):
        if self._lock.acquire():
            self._lock.release()




