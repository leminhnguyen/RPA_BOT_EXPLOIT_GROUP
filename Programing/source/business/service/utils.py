import os
import sys

import win32clipboard
from PyQt5 import QtGui, QtCore
from PyQt5.QtWidgets import QApplication, QMessageBox


def get_resource_path(relative_path, type_=""):
    """ get absolute path to resource """
    try:
        base_path = sys._MEIPASS  # for Pyinstaller
    except Exception:
        base_path = os.path.join('../assets', type_)  # for dev
    return os.path.abspath(os.path.join(base_path, relative_path))


def dict_get_multikeys(dict_, *keys, default=None):
    for key in keys:
        if key in dict_:
            return dict_[key]
    return default


def show_message(title, info, type_=QMessageBox.Information):
    """ show message """
    QApplication.instance()
    message_box = QMessageBox()
    message_box.setText(info)
    message_box.setWindowTitle(title)
    message_box.setWindowIcon(QtGui.QIcon(Path.ICON_PATH))
    message_box.setWindowFlags(QtCore.Qt.WindowStaysOnTopHint)
    message_box.setIcon(type_)
    message_box.activateWindow()
    message_box.exec_()


def get_saved_paths():
    """ get file path that user used last time """
    if not os.path.isfile(Path.SAVED_PATH) or os.stat(Path.SAVED_PATH).st_size == 0:
        return ''

    with open(Path.SAVED_PATH, encoding='utf-8', mode='r') as f:
        path = f.read()
    return path


def save_paths(new_path):
    """ save the path user use """
    with open(Path.SAVED_PATH, encoding='utf-8', mode='w') as f:
        f.write(new_path)


def as_text(value):
    """ convert arbitrary value to string """
    return str(value) if value is not None else ""


def remove_qt_temporary_files():
    if os.path.exists('qt.conf'):
        os.remove('qt.conf')


def get_clipboard_data():
    win32clipboard.OpenClipboard()
    data = win32clipboard.GetClipboardData()
    win32clipboard.EmptyClipboard()
    win32clipboard.CloseClipboard()
    return data


def clear_clipboard():
    try:
        win32clipboard.OpenClipboard()
        win32clipboard.EmptyClipboard()
        win32clipboard.CloseClipboard()
    except Exception:
        pass


class Path:
    ICON_PATH = get_resource_path("ac_solution.ico", type_="image")
    IMG_PATH = get_resource_path("ac_solution.jpg", type_="image")
    QSS_PATH = get_resource_path("style_sheet.qss", type_="file")
    SAVED_PATH = get_resource_path("saved_paths.txt", type_="file")
    TIMER_QSS_PATH = get_resource_path("timer_stylesheet.qss", type_="file")
    REMINDER_FILE = get_resource_path("reminder.mp3", type_="file")
    BOT_ROOT_FOLDER = os.path.join(
        dict_get_multikeys(os.environ, "LOCALAPPDATA", "USERPROFILE", "TEMP", "TMP", os.getcwd()),
        "AC_SOLUTION",
    )
    CHROME_DRIVER_PATH = os.path.join(BOT_ROOT_FOLDER, "ChromeDriver")